[English](README_EN.md)
### æ¦‚è¿°
ä¸ºäº†å¹¿æ³›æ”¯æŒè¥é”€æ´»åŠ¨çš„å¤æ‚ä¸çµæ´»ï¼ŒWonder8.promotionï¼ˆæ—ºå¾·ç™¼ğŸ€.è¥é”€ï¼‰å¼•æ“ä½¿ç”¨ä¸“é—¨è®¾è®¡çš„è¡¨è¾¾å¼é«˜åº¦æç‚¼ä¿¡æ¯ï¼Œå¯ä»¥è½»æ¾è¡¨è¾¾è¥é”€æ´»åŠ¨ä¸ç”¨æˆ·é€‰å–çš„å•†å“ç»„åˆä¹‹é—´åŒ¹é…èŒƒå›´ã€è¦æ±‚ã€æŠ˜æ‰£æ–¹å¼ï¼Œå¯ä»¥è®¾å®šå¤šæ¡è¥é”€è§„åˆ™çš„é€»è¾‘è”åˆã€åˆ†ç»„ã€ä¼˜å…ˆçº§ï¼Œå¹¶ä¸”æ”¯æŒå¤šç§ä¸ºç”¨æˆ·è®¡ç®—æœ€ä¼˜æŠ˜æ‰£çš„ç­–ç•¥ã€‚

æœ¬å¼•æ“åŠŸèƒ½ç»†èŠ‚è¾ƒå¤šï¼Œå»ºè®®ç”¨ä»¥ä¸‹æ­¥éª¤æ¥å­¦ä¹ å’Œåº”ç”¨ï¼š
1. å…ˆé€šè¿‡ç®€å•éœ€æ±‚åœºæ™¯æ¥ç†Ÿæ‚‰APIï¼Œæ­¤æ—¶åªéœ€è¦ç”¨åˆ°è¡¨è¾¾å¼(Rule)ï¼Œè¡¨è¾¾å¼è§£é‡Šå™¨(Interpreter)å’Œä¼˜æƒ è®¡ç®—ç­–ç•¥(Strategy)ï¼Œå¤§éƒ¨åˆ†ç¨‹åºå‘˜æŒæ¡äº†è¡¨è¾¾å¼è¯­æ³•åï¼Œä¼šå«ŒBuilderéº»çƒ¦è€Œç›´æ¥æ‹¼å†™è¡¨è¾¾å¼å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥Builderéƒ½ä¸ä¸€å®šè¦ç†Ÿæ‚‰ï¼Œæ¯”å¦‚ï¼š
- å®šä¹‰è§„åˆ™ï¼šä¹°ä¸¤å°512Gçš„é»‘æˆ–ç™½è‰²iPhone15ï¼ŒæŠ˜æ‰£400å…ƒï¼Œä¸‰å°æŠ˜æ‰£700å…ƒï¼š
    - [#kiPhone15-black-512g#kiPhone15-white-512g].count(2)->-40000
    - [#kiPhone15-black-512g#kiPhone15-white-512g].count(3)->-70000
- ç„¶åè°ƒç”¨Strategy.bestChoice(rules, items, MatchType.MultiRule)å³å¯åœ¨ç”¨æˆ·è´­ä¹°4å°iPhoneæ—¶è®¡ç®—å‡ºæŠ˜æ‰£800å…ƒï¼Œè´­ä¹°5å°æ—¶æŠ˜æ‰£1100å…ƒï¼Œä»¥åŠè®¡ç®—å‡ºåº”ç”¨æŠ˜æ‰£åå¦‚æœè¿˜æœ‰ä½™å‡ºçš„ç‰©å“ï¼Œç”¨æˆ·å¦‚ä½•æ‹¼å•è·å¾—æ›´å¤šçš„æŠ˜æ‰£ã€‚
2. å°è¯•ç¼–å†™å¤æ‚çš„è§„åˆ™ç»„åˆç†Ÿæ‚‰åˆ†ç»„ã€å•†å“ç»„åˆã€å¤šç§è®¡ç®—ç­–ç•¥å’Œè®¡ç®—èŒƒå›´ç­‰æ¦‚å¿µã€‚
3. å°è¯•ä¸ºè‡ªå·±çš„ä¸šåŠ¡åœºæ™¯æ‰©å±•å¼•æ“åŠŸèƒ½ï¼Œæœ¬å¼•æ“æœ‰æ¸…æ™°çš„ç»“æ„ï¼Œå„éƒ¨åˆ†ç›¸äº’ç‹¬ç«‹ï¼Œå¾€å¾€èƒ½æ·»åŠ 10æ¥è¡Œä»£ç å³æ‰©å±•æ–°çš„åŠŸèƒ½ã€‚

#### åŠŸèƒ½ç‰¹æ€§ï¼š
* æ”¯æŒé’ˆå¯¹ç”¨æˆ·é€‰å®šçš„ä¸€æ‰¹å•†å“ï¼Œä»ä¸€å †è¥é”€è§„åˆ™ä¸­è‡ªåŠ¨åº”ç”¨æœ€å¤§çš„ä¼˜æƒ ï¼›
* å¯ä»¥åŒæ—¶åº”ç”¨å¤šä¸ªè§„åˆ™ï¼Œè§„åˆ™ä¹‹é—´å¯ä»¥æ˜¯ä¸å’Œæˆ–çš„å…³ç³»ï¼Œå¯ä»¥é™å®šè§„åˆ™ç»„åˆçš„ä¼˜å…ˆçº§ï¼›
* å¯ä»¥å¯¹è§„åˆ™åˆ†ç»„ï¼Œé™å®šå…ˆåº”ç”¨ä¸€ç»„ï¼Œå†åº”ç”¨å¦ä¸€ç»„ï¼›
    * å¯ä»¥é™å®šå¿…é¡»åº”ç”¨å®Œä¸€ç»„ä¼˜æƒ æ‰èƒ½è®¡ç®—ä¸‹ä¸€ç»„ä¼˜æƒ ï¼›
    * ä¹Ÿå¯ä»¥æŠŠå„ç»„ä¼˜æƒ æ–¹å¼äº¤å‰å¯¹æ¯”æœ€ä¼˜ç»„åˆï¼›
* å¤šç§è§„åˆ™åŒ¹é…æ–¹å¼æ±‚æœ€ä½³ä¼˜æƒ ï¼š
    * æœ€ä¼˜çš„åªåŒ¹é…ä¸€æ¬¡è§„åˆ™ï¼›
    * æœ€ä¼˜çš„å•è§„åˆ™å¤šæ¬¡åŒ¹é…ï¼›
    * æœ€ä¼˜çš„å¤šè§„åˆ™å¤šæ¬¡åŒ¹é…ï¼›
* å¯ä»¥æ”¯æŒç±»ä¼¼äºä¹°12ç“¶æ°´å¯ä»¥åˆæˆä¸¤ç®±æ°´ï¼ˆå¦ä¸€ä¸ªSKUï¼‰,è€Œä¸¤ç®±æ°´åˆå¯ä»¥åº”ç”¨å¦ä¸€ç§è§„åˆ™ï¼›
* å¯ä»¥è®¡ç®—æ¨èç”¨æˆ·å†æ·»åŠ ä»€ä¹ˆå•†å“å¯ä»¥è·å¾—ä¸‹ä¸€ä¸ªä¼˜æƒ ï¼›
* åŒæ—¶æä¾›æœåŠ¡ç«¯Javaå®ç°å’Œå®¢æˆ·ç«¯JSå®ç°ï¼Œä¾¿äºä¸‹æ”¾ä¼˜æƒ è§„åˆ™åï¼Œå®¢æˆ·ç«¯å®æ—¶å¾—å‡ºä¼˜æƒ ç»“æœï¼›
* åŸºäºä¸“é—¨è®¾è®¡çš„å­—ç¬¦ä¸²è¡¨è¾¾å¼ï¼Œå„ç§å˜æ€ç»„åˆç©æ³•å¯ä»¥çµæ´»ç›´è§‚è¡¨è¾¾ï¼Œå¹¶ä¸”æä¾›Builderå’ŒInterpreterä¸ºå­—ç¬¦ä¸²å’Œç»“æ„åŒ–å¯¹è±¡é—´è½¬æ¢ï¼›
* ä»£ç ç»“æ„æ¸…æ™°ï¼Œè¿›è¡ŒåŠŸèƒ½æ‰©å±•å’Œå„ç±»è§„åˆ™ç»„åˆåœºæ™¯æ‰©å±•æ¯”è¾ƒæ–¹ä¾¿ï¼›


### åŠŸèƒ½è¯´æ˜
æ‰€æœ‰æƒ³æ³•æºè‡ªäºä¸€ä¸ªè¥é”€æŠ˜æ‰£çš„è§„åˆ™å¯ä»¥æŠ½è±¡æˆä¸‰ä¸ªéƒ¨åˆ†ï¼š
1. è§„åˆ™é€‚ç”¨çš„èŒƒå›´(Range)
    1. æˆ‘ä»¬æš‚ä¸”å°†èŒƒå›´è¡¨è¾¾æˆä¸‰å±‚ï¼šç±»ç›®ã€SPUã€SKUï¼Œä¸åŒåœºæ™¯å¯ä»¥æ‰©å±•ï¼Œç”±äºå­—ç¬¦ä¸²å¯ä»¥è‡ªç”±ä¸²æ¥ï¼Œä¸€èˆ¬æƒ…å†µä¹Ÿä¸éœ€è¦æ‰©å±•ï¼Œæ¯”å¦‚:å¤§ç±»ç›®-å°ç±»ç›®å°±ç›¸å½“äºæ‰©å±•äº†ä¸€å±‚ï¼›
    2. ä¸€ä¸ªè§„åˆ™å¯ä»¥æœ‰é€‚ç”¨å¤šä¸ªèŒƒå›´ï¼Œå³èŒƒå›´å¯ä»¥æ˜¯ä¸€ä¸ªç»„åˆï¼›
2. è§„åˆ™çš„è¦æ±‚(Predict &amp; Validate)
    1. è§„åˆ™çš„è¦æ±‚å¯ä»¥æŠ½è±¡å‡ºæ¥ï¼Œä¸»è¦æ˜¯ï¼šè¦æ±‚æœ‰å¤šå°‘ä¸ªï¼Œè¦æ±‚è¾¾åˆ°å¤šå°‘æ€»ä»·å€¼ï¼Œè¦æ±‚å«æœ‰å¤šå°‘ç§ï¼Œå¿…é¡»æ­å”®æŸä¸ªå•†å“ç­‰ï¼›
    2. è®¡ç®—æ–¹å¼ï¼ˆPredictï¼‰å¯ä»¥æ‰©å±•ï¼›
3. ä¼˜æƒ æ–¹æ¡ˆï¼ˆPromotionï¼‰
    1. ä¼˜æƒ æ–¹æ¡ˆå¾€å¾€æ˜¯ï¼šå›ºå®šå‡å¤šå°‘é’±ï¼Œæ¯æ»¡å¤šå°‘é’±å‡å¤šå°‘é’±ï¼ŒæŒ‰æ¯”ä¾‹æŠ˜æ‰£ï¼Œç›´æ¥å‡åˆ°ä¸€ä¸ªå›ºå®šå€¼ï¼ˆä¸€å£ä»·ï¼‰
       æ‰€ä»¥ä¸€æ¡è¥é”€è§„åˆ™å°±æ˜¯ï¼š[range].predict(expectedValue)ã€‚

#### è¡¨è¾¾å¼è¯­æ³•
Wonder8.promotionä½¿ç”¨è¡¨è¾¾å¼æ¥è¡¨è¾¾å’Œç»„åˆè¥é”€è§„åˆ™ï¼Œå¦‚è¡¨ç¤ºå½“ä¸€ç»„å•†å“ä¸­åŒ…æ‹¬é£Ÿå“-æ°´æœã€é£Ÿå“-è‚‰ç±»ã€é£Ÿå“-è”¬èœä¸‰å¤§ç±»ä¸­è‡³å°‘ä¸¤ä¸ªæ—¶ï¼Œä¼˜æƒ 10%ï¼š"[#cFOOD-FRUIT#cFOOD-MEAT#cFOOD-VEGETABLE].countCate(2)->-10%"ï¼š
1. ä¸€æ¡è¥é”€è§„åˆ™ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œè§„åˆ™é€‚ç”¨çš„èŒƒå›´ï¼Œè§„åˆ™è®¡ç®—çš„æ–¹æ³•ï¼Œè§„åˆ™åº”ç”¨çš„ä¼˜æƒ ç»“æœï¼š
    1. [range].predict(expectedVaue)æ˜¯ä¸€æ¡è§„åˆ™çš„æ ¼å¼
2. ç”¨æˆ·å½“å‰é€‰æ‹©äº†10ä¸ªç‰©å“ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯æ¯ä¸€ä¸ªç‰©å“éƒ½ç¬¦åˆè¿™æ¡è§„åˆ™çš„èŒƒå›´ï¼Œåˆ™å®ƒä¸åº”è®¡ç®—åœ¨å†…ã€‚æ‰€ä»¥é€‚ç”¨èŒƒå›´æ˜¯é¦–è¦è®¾ç½®çš„ï¼š
    1. [#cCate1#cCate2#â€¦â€¦]è¡¨ç¤ºæ³•ä¸­ï¼Œ#æ˜¯ä¸€ä¸ªèŒƒå›´å¯¹è±¡çš„è¡¨è¾¾å¼€å§‹ï¼Œcæ˜¯ç±»å‹ï¼ˆå¯é€‰c-ç±»ç›®ï¼Œp-SPUï¼Œk-SKUï¼Œå¯ä»¥æ‰©å±•ï¼‰ï¼Œåé¢æ˜¯IDï¼Œ[]å†…å¯ä»¥æ”¾>=1ä¸ªå¯¹è±¡ï¼›
    2. \$è¡¨ç¤ºå…¨éƒ¨ï¼š\$.sum(20000)ï¼›
    3. ~è¡¨ç¤ºå¤ç”¨ä¸Šä¸€æ¡è§„åˆ™çš„èŒƒå›´ï¼š[#ccate01#ccate02#ccate03].countCate(2) &amp; ~.countSPU(5) &amp; \$.countSKU(5) &amp; ~.sum(10000))ï¼Œæ„å‘³ç€åœ¨ç±»ç›®cate01,cate02,cate03è¿™ä¸ªèŒƒå›´å†…ï¼Œç‰©å“ç»„åˆéœ€è¦æ»¡è¶³ç±»ç›®æ¶µç›–2ä¸ªï¼ŒSPUæ¶µç›–5ä¸ªï¼ŒSKUæ¶µç›–5ä¸ªï¼Œæ€»ä»·è¾¾åˆ°10000ã€‚
3. .predict()è¡¨ç¤ºè®¡ç®—çš„æ–¹æ³•ï¼Œå½“å‰æ”¯æŒcountCategory()è®¡ç®—èŒƒå›´å†…å«å¤šå°‘ä¸ªç±»ç›®ï¼ŒcountSPU()è®¡ç®—èŒƒå›´å†…å«å¤šå°‘ä¸ªSPUï¼ŒcountSKU()è®¡ç®—èŒƒå›´å†…å«å¤šå°‘ä¸ªSKUï¼Œcountï¼ˆï¼‰è®¡ç®—å¤šå°‘ä¸ªç‰©å“ï¼ŒoneSKU()è®¡ç®—æŸç§SKUå«å¤šå°‘ä¸ªï¼Œsum()è®¡ç®—ä»·æ ¼çš„åˆè®¡ã€‚
4. expectedValueæ˜¯ä¸€ä¸ªintæ•°å­—ï¼Œè¡¨ç¤ºè®¡ç®—ç»“æœè¦>=è¿™ä¸ªæ•°ï¼Œ æ‰èƒ½é€šè¿‡ã€‚
5. è§„åˆ™å¯ä»¥è”åˆï¼Œç”¨&amp;è¡¨ç¤ºå¹¶ä¸”ï¼Œç”¨|è¡¨ç¤ºæˆ–è€…ï¼Œè§„åˆ™å¯ä»¥åˆ†ç»„ï¼Œç”¨()ï¼Œæ¯”å¦‚(rule1&amp;rule2&amp;rule3)|rule4ï¼Œè¡¨ç¤ºï¼Œ1ã€2ã€3éƒ½è¦è¾¾æˆæˆ–è€…4è¾¾æˆï¼Œå‡å¯é€šè¿‡è§„åˆ™ï¼š
    ```javascript
    "([#pp01#pp02#pp03].countCate(2) & \$.countSPU(3) & \$.count(5) & \$.sum(10000)) | \$.sum(50000)"
   ```
6. æ¯æ¡è§„åˆ™ç”±è®¡ç®—éƒ¨åˆ†å’Œä¸€ä¸ªè§„åˆ™ä¼˜æƒ éƒ¨åˆ†ç»„æˆï¼Œä¸­é—´ç”¨->è¿æ¥ï¼›
7. ä¼˜æƒ éƒ¨åˆ†çš„è¯­æ³•æ˜¯ï¼š
    1. -1000 è¡¨ç¤ºå›ºå®šä¼˜æƒ 10å—é’±ï¼ˆæ‰€ä»¥é’±ç›¸å…³çš„è®¡ç®—å•ä½æ˜¯åˆ†ï¼‰
    2. -1000/10000 è¡¨ç¤ºæ¯100å—é’±ä¼˜æƒ 10å—é’±
    3. -10% è¡¨ç¤ºä¼˜æƒ 10%ï¼Œå³æ‰“9æŠ˜ï¼Œæ·»åŠ äº†å°æ•°ç‚¹æ”¯æŒæ¯”å¦‚-0.5%è¡¨ç¤ºä¼˜æƒ 95.5%
    4. 8000 è¡¨ç¤ºä¸€å£ä»·ï¼Œ80å—é’±
    5. -0è¡¨ç¤ºä¼˜æƒ 0å…ƒï¼Œ0è¡¨ç¤ºä¼˜æƒ åˆ°0å…ƒ

#### è§„åˆ™å¯¹è±¡
å¯¹åº”è¡¨è¾¾å¼ï¼Œæœ‰ä¸€ç³»ç»Ÿçš„ç»“æ„åŒ–å¯¹è±¡ï¼š
1. Rule -- å¯¹åº”ä¸€æ¡å®Œæ•´çš„è¥é”€è§„åˆ™ï¼Œä¸»è¦å±æ€§æ˜¯condition è¡¨ç¤ºæ¡ä»¶è§„åˆ™ï¼Œpromotionè¡¨ç¤ºä¼˜æƒ è§„åˆ™
    1. å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œå› ä¸ºè¦å¯¹ç”¨æˆ·æç¤ºï¼Œæ˜¾ç¤ºæ ‡ç­¾ç­‰ï¼Œæ‰€ä»¥éœ€è¦æ‰©å±•Ruleç±»ï¼Œæä¾›æ›´å¤šä¸è®¡ç®—æ— å…³çš„é™„åŠ å±æ€§ï¼Œå‚è§æµ‹è¯•ç”¨ä¾‹ä¸­çš„RuleImplç±»ã€‚
2. SimplexRule -- å¯¹åº”ä¸€æ¡æ¡ä»¶è§„åˆ™ï¼Œä¸»è¦å±æ€§æ˜¯rangeè¡¨ç¤ºæ¡ä»¶è®¡ç®—èŒƒå›´ï¼Œpredictè¡¨ç¤ºè®¡ç®—æ–¹æ³•ï¼Œexpctetedè¡¨ç¤ºè¾¾æ ‡çš„å€¼ã€‚
3.  SameRangeRule -- ä¸å‰ä¸€æ¡æ¡ä»¶è§„åˆ™èŒƒå›´ç›¸åŒçš„è§„åˆ™ï¼Œç”¨~å¤ç”¨å‰è¿°è§„åˆ™çš„èŒƒå›´è¡¨è¾¾å¼ã€‚
4.  AndCompositeRule -- è¡¨ç¤ºandé€»è¾‘çš„æ¡ä»¶è§„åˆ™ç»„ï¼Œä¸»è¦å±æ€§æ˜¯ä¿å­˜å­è§„åˆ™é›†åˆçš„componentsï¼Œå¯ä»¥addRule()æ·»åŠ å­è§„åˆ™ï¼Œå­è§„åˆ™å¯ä»¥æ˜¯Simplex/SameRangeï¼Œä¹Ÿå¯ä»¥æ˜¯AndComposite/OrCompositeã€‚
5.  OrCompositeRule -- è¡¨ç¤ºoré€»è¾‘çš„æ¡ä»¶è§„åˆ™ç»„ï¼Œå…¶å®ƒåŒAndComposite
6.  Ruleçš„conditionå¯ä»¥æ˜¯Simplex/AndComposite/OrCompositeï¼Œä¸èƒ½æ˜¯SameRange,ä¸ç„¶SameRangeå»å“ªé‡Œå¤ç”¨èŒƒå›´è§„åˆ™
7.  Rule/Simplex/SameRange/AndComposite/OrCompositeéƒ½æœ‰å¯¹åº”çš„builder,é€šè¿‡Builder.rule()/simplex()/and()/or()å¯ä»¥æ‰¾åˆ°builderçš„å¿«æ·å…¥å£ã€‚è§[è§„åˆ™çš„åˆ›å»º]
8.  æ¡ä»¶å¯ä»¥é€šè¿‡Rule.toString()æ–¹æ³•å’ŒInterprecter.parseString()æ¥å®ç°å¼ºç±»å‹å®ä¾‹ä¸å­—ç¬¦ä¸²è¡¨è¾¾å¼ä¹‹é—´çš„äº’ç›¸è½¬æ¢ã€‚

#### è§„åˆ™çš„åˆ›å»º
/model/builder/ç›®å½•ä¸‹æœ‰ä¸€æ•´å¥—builderç”¨äºä»¥ç»“æ„åŒ–çš„æ–¹å¼åˆ›å»ºè§„åˆ™ï¼Œè¯­æ³•æ¸…æ™°ã€‚
```java
public class ConditionBuilderTest {
    @Test
    public void testBuildRule(){
        //åˆ›å»ºè§„åˆ™æœ‰ä¸‰ç§æ–¹æ³•ï¼š
        //ä¸€ç§æ˜¯Builder.rule().xxx().xxx().build()
        //ç¬¬äºŒç§æ˜¯new RuleBuiler().xxx().xxx().build()
        //ç¬¬ä¸‰ç§æ˜¯ç›´æ¥new Rule()ï¼Œé€šè¿‡contructorå’Œpropertiesæ¥å®Œæˆè®¾ç½®
        RuleComponent rule1 = Builder.rule()//ä¸Šä¸‹æ–‡æ˜¯Rule
                .simplex().addRangeAll()//æ³¨æ„è¿™é‡Œä¸Šä¸‹æ–‡åˆ‡æ¢åˆ°äº†simplexæ¡ä»¶çš„ç¼–å†™
                .predict(P.SUM).expected(100)
                .end() //é€šè¿‡.end()ç»“æŸå½“å‰å¯¹è±¡ç¼–å†™ï¼Œè¿”å›åˆ°ä¸Šä¸€çº§ï¼Œä¹Ÿå°±æ˜¯Rule
                .endRule()//å› ä¸º.end()æ–¹æ³•è¿”å›çš„æ˜¯åŸºç±»ï¼Œæ‰€ä»¥éœ€è¦.backRule()åˆ‡æ¢å›RuleBuilderæ‰èƒ½ç›´æ¥è°ƒç”¨.promotion()è¿™æ ·ç‰¹æ®Šçš„æ–¹æ³•ï¼Œç»§ç»­ç¼–å†™ä¸‹å»
                .promotion("-10")
                .build();

        System.out.println(rule1.toString());
    }

    @Test
    public void testBuildSimplexRule(){
        /*
          Builderé™¤äº†èƒ½Builder.rule()æ¥å¼€å§‹ç¼–æ’ä¸€ä¸ªå®Œæ•´çš„è¥é”€è§„åˆ™ï¼Œ
          ä¹Ÿè¿˜æœ‰Builder.simplex()/.or()/.and()æ¥å¼€å§‹ç¼–æ’ä¸€ä¸ªå•ä¸€/æˆ–ç»„åˆ/ä¸ç»„åˆ
          ä½†è¯·æ³¨æ„ï¼Œé™¤.rule()æ˜¯å¼€å§‹ç¼–å†™ä¸€ä¸ªå®Œæ•´çš„è¥é”€è§„åˆ™ï¼Œå…¶å®ƒæ–¹æ³•åªæ˜¯åœ¨å¼€å§‹ç¼–æ’è§„åˆ™ä¸­çš„æ¡ä»¶éƒ¨åˆ†
          æœ€ç»ˆ.build()å‡ºæ¥çš„ä¸€ä¸ªæ˜¯Ruleï¼Œä¸€ä¸ªæ˜¯Condition
        */
        SimplexRule rule1 = Builder.simplex() // same as => new SimplexRuleBuilder()
                .addRangeAll()
                .predict(P.SUM).expected(100)
                .build();
        System.out.println(rule1.toString());
    }

    @Test
    public void testParseRange(){
        SimplexRule rule1 = new SimplexRuleBuilder()
                .range("[#pSPU1#pSPU2]")
                .predict(P.SUM).expected(100)
                .build();
        System.out.println(rule1.toString());
    }


    @Test
    public void testBuildOrCompositeRule(){
        RuleComponent or =  new OrCompositeRuleBuilder()
                .simplex().addRangeAll().predict(P.SUM).expected(100).end()
                .simplex().addRange(R.SPU,"SPUID1").predict(P.COUNT).expected(5).end()
                .sameRange().predict(P.COUNT_SPU).expected(2).end()
                .build();
        System.out.println(or);
    }

    @Test
    public void testBuildAndCompositeRule(){
        RuleComponent and = new AndCompositeRuleBuilder()
                .simplex().addRanges(R.SPU, Arrays.asList("SPUID1","SPUID2")).predict(P.COUNT).expected(5).end()
                .simplex().addRangeAll().predict(P.COUNT_SPU).expected(5).end()
                .sameRange().predict(P.COUNT).expected(10).end()
                .build();
        System.out.println(and);
    }
}
```
å…·ä½“ç”¨æ³•å¯ä»¥å‚è§testä¸‹çš„ConditionBuilderTest.javaå’ŒRuleTest.javaã€‚

#### è¡¨è¾¾å¼çš„è§£æ
Interprecterç±»å®ç°å¯¹è§„åˆ™å­—ç¬¦ä¸²çš„è§£é‡Šï¼Œå¯ä»¥å°†å­—ç¬¦ä¸²è½¬åŒ–æˆæ¨¡å‹ç»“æ„ï¼ŒInterprecter.parseString(ruleString)
```java
public class InterpreterTest {

    @Test
    public void validateCondition() {
        String ruleStr = "($.count(5)&[#cCATEGORY1#cCATEGORY2].sum(10)&~.countSPU(2))|$.sum(100)";
        assertTrue(Interpreter.validateCondition(ruleStr));
    }

    @Test
    public void parseString() {
        String ruleStr = "($.count(5)&[#cCATEGORY1#cCATEGORY2].sum(10)&~.countSPU(2))|$.sum(100)";
        RuleComponent rule = Interpreter.parseString(ruleStr);
        System.out.println(rule);
        assertEquals(ruleStr,rule.toString());

        ruleStr = "($.count(5)|([#cCATEGORY1#cCATEGORY2].sum(10)&~.countSPU(2)))|$.sum(100)";
        rule = Interpreter.parseString(ruleStr);
        System.out.println(rule);
        assertEquals(ruleStr,rule.toString());

        ruleStr = "(($.count(5)&[#cCATEGORY1#cCATEGORY2].sum(10))|([#cCATEGORY1#cCATEGORY2].sum(10)&~.countSPU(2)))|$.sum(100)";
        rule = Interpreter.parseString(ruleStr);
        System.out.println(rule);
        assertEquals(ruleStr,rule.toString());

        ruleStr = "(($.count(5)&[#cCATEGORY1#cCATEGORY2].sum(10))|[#cCATEGORY1#cCATEGORY2].sum(10))|$.sum(100)";
        rule = Interpreter.parseString(ruleStr);
        System.out.println(rule);
        assertEquals(ruleStr,rule.toString());

        ruleStr = "(($.count(5)&[#cCATEGORY1#cCATEGORY2].sum(10))|[#cCATEGORY1#cCATEGORY2].sum(10))|($.sum(100)&~.countCate(2))";
        rule = Interpreter.parseString(ruleStr);
        System.out.println(rule);
        assertEquals(ruleStr,rule.toString());
    }

    @Test
    public void foldRuleString(){
        String rule = "[#c01#c02#c03].countCate(2)&[#c01#c02#c03].countSPU(5)|[#c01#c02#c03].count(10)&[#c01].sum(10)";
        String expected = "[#c01#c02#c03].countCate(2)&~.countSPU(5)|~.count(10)&[#c01].sum(10)";
        String actual = Interpreter.foldRuleString(rule);
        assertEquals(expected,actual);

        String rule2 = "[#c01#c02#c03].countCate(2)&[#c01#c02#c03].countSPU(5)|([#c01#c02#c03].count(10)&[#c01].sum(10))";
        String expected2 = "[#c01#c02#c03].countCate(2)&~.countSPU(5)|([#c01#c02#c03].count(10)&[#c01].sum(10))";
        String actual2 = Interpreter.foldRuleString(rule2);
        assertEquals(expected2,actual2);

    }

    @Test
    public void unfoldRuleString(){
        String rule = "[#c01#c02#c03].countCate(2)&~.countSPU(5)|~.count(10)&[#c01].sum(10)";
        String expected = "[#c01#c02#c03].countCate(2)&[#c01#c02#c03].countSPU(5)|[#c01#c02#c03].count(10)&[#c01].sum(10)";
        String actual = Interpreter.unfoldRuleString(rule);
        assertEquals(expected,actual);

        String expected2 = "[#c01#c02#c03].countCate(2)&[#c01#c02#c03].countSPU(5)|([#c01#c02#c03].count(10)&[#c01].sum(10))";
        String rule2 = "[#c01#c02#c03].countCate(2)&~.countSPU(5)|([#c01#c02#c03].count(10)&[#c01].sum(10))";
        String actual2 = Interpreter.unfoldRuleString(rule2);
        assertEquals(expected2,actual2);
    }
}
```

#### è§„åˆ™æ˜¯å¦åŒ¹é…
Rule.check(items);

#### è§„åˆ™åŒ¹é…ç»“æœè¯¦æƒ…
Rule.validate(tickets) -> RuleValidateResultå¯¹è±¡
result.valid = result.expected vs. result.actual

#### ä¼˜æƒ è®¡ç®—
Rule.discount(items) -> int. è¿”å›ä¸€ä¸ªè´Ÿå€¼ï¼Œå³ä¼˜æƒ çš„æ•°ï¼Œæ³¨æ„ä¸€å£ä»·çš„è§„åˆ™ï¼Œä¹Ÿæ˜¯ç›®æ ‡ä»·æ ¼å‡å»å½“å‰ç¥¨ä»·æ€»å’Œå¾—å‡ºçš„ä¼˜æƒ æ‰çš„å€¼ï¼Œæ¯”å¦‚å½“å‰æ‰€é€‰ç¥¨ä»·æ€»å’Œæ˜¯10000ï¼Œä¸€å£ä»·è§„åˆ™æ˜¯8000ï¼Œåˆ™è¿”å›-2000
> result.isValid()?r.discount(selectedTickets):0

##### å››ç§è®¡ç®—èŒƒå›´
ä¼˜æƒ è®¡ç®—æœ‰å››ç§è®¡ç®—èŒƒå›´ï¼š
å‡è®¾æ€»å…±9ä¸ªç‰©å“ï¼Œ01å·100å—çš„2ä¸ªï¼Œ02å·121.2å—çš„6ä¸ªï¼Œ03å·0.5å—çš„1ä¸ªï¼Œè§„åˆ™æ˜¯01ï¼Œ02å·æ€»å…±è¦6ä¸ªï¼Œå¹¶ä¸”ä¸¤ç§éƒ½è¦æœ‰ï¼š
1. Strategy.bestMatch()çš„ç­–ç•¥æ˜¯æ±‚æœ€ä½æˆæœ¬ä¸‹è¾¾æˆæœ€å¤šä¼˜æƒ ï¼Œå¦‚æœæ˜¯æ¯”ç‡æŠ˜æ‰£ï¼Œå®ƒä¼šå–é«˜ä»·ç¥¨ï¼Œå¦åˆ™å–ä½ä»·ç¥¨ï¼Œä¸Šä¾‹ç»“æœæ˜¯è®¡ç®—1å¼ 01å’Œ5å¼ 02ï¼›
    1. å¦‚æœè§„åˆ™Açš„promotionæ˜¯æ»¡æŠ˜æ»¡å‡(%,/)ï¼Œåˆ™ä¼šåŒæ—¶è®¡ç®—å°†æ›´å¤šç¥¨åŒ¹é…åˆ°Aæ˜¯å¦ä¼šå¸¦æ¥æ›´å¤šçš„ä¼˜æƒ 
2. Strategy.bestOfOnlyOnceDiscount()çš„ç­–ç•¥æ˜¯åªå…è®¸ä½¿ç”¨ä¸€æ¬¡ä¼˜æƒ è§„åˆ™ï¼Œæ‰€ä»¥è®¡ç®—è¾¾æˆè§„åˆ™æ‰€éœ€çš„æœ€å°‘å¼ æ•°ï¼Œä½†æ˜¯æ˜¯æœ€é«˜ä»·æ ¼çš„ç¥¨ï¼Œä¸Šä¾‹ç»“æœæ˜¯è®¡ç®—1å¼ 01å’Œ5å¼ 02ï¼›
    1. å¦‚æœè§„åˆ™Açš„promotionæ˜¯æ»¡æŠ˜æ»¡å‡(%,/)ï¼Œåˆ™ä¼šåŒæ—¶è®¡ç®—å°†æ›´å¤šç¥¨åŒ¹é…åˆ°Aæ˜¯å¦ä¼šå¸¦æ¥æ›´å¤šçš„ä¼˜æƒ 
3. Rule.discount()ï¼Œä¼šå¯¹æ‰€æœ‰ç¥¨åº”ç”¨ä¼˜æƒ ï¼Œä¸Šä¾‹ç»“æœæ˜¯è®¡ç®—æ‰€æœ‰9å¼ ç¥¨ï¼›
4. Rule.discountFilteredItems()ï¼Œä¼šå¯¹è§„åˆ™æŒ‡å®šèŒƒå›´å†…çš„æ‰€æœ‰ç¥¨è®¡ç®—ä¼˜æƒ ï¼Œä¸Šä¾‹ç»“æœæ˜¯è®¡ç®—2å¼ 01å’Œ6å¼ 02ï¼Œä¸å«03ï¼›
   æ³¨æ„ï¼ŒStrategyæ”¯æŒå•è§„åˆ™å¤šæ¬¡åŒ¹é…åº”ç”¨å’Œå¤šæ¡è§„åˆ™è”åˆå¤šæ¬¡åº”ç”¨ï¼Œæ›´ç¬¦åˆâ€œæœ€ä¼˜â€çš„æ¦‚å¿µã€‚
```javascript
test("4 discounting algorithm", () => {

    const ruleString = "[#k02#k01].count(6)&~.countCate(2) -> -50%";
    const items = [
        { category: "01", SPU: "01", SKU: "01",price: 10000 },
        { category: "01", SPU: "01", SKU: "01",price: 10000 },
        { category: "02", SPU: "02", SKU: "02",price: 121200 },
        { category: "02", SPU: "02", SKU: "02",price: 121200 },
        { category: "02", SPU: "02", SKU: "02",price: 121200 },
        { category: "02", SPU: "02", SKU: "02",price: 121200 },
        { category: "02", SPU: "02", SKU: "02",price: 121200 },
        { category: "02", SPU: "02", SKU: "02",price: 121200 },
        { category: "02", SPU: "02", SKU: "03",price: 50 },
    ];

    const rule = Interpreter.parseString(ruleString);
    let expected = 0, actual = 0;
    //ä¸ºäº†åšè§„åˆ™æ¨èçš„è¿ç®—ï¼Œè§„åˆ™æœ¬èº«ç®—æŠ˜æ‰£çš„æ–¹æ³•é‡Œï¼Œ
    // å¹¶æ²¡æœ‰åˆ¤å®šè§„åˆ™æ˜¯å¦å·²è¾¾æˆï¼Œæ‰€ä»¥è°ƒç”¨å‰éœ€åšcheck()
    if(rule.check(items)){
        //ç¬¬1ç§ï¼Œrule.discountFilteredItems(items)
        //è®¡ç®—çš„æ˜¯è§„åˆ™èŒƒå›´å†…çš„è¿™éƒ¨åˆ†å•†å“çš„æŠ˜æ‰£
        expected = rule.filterItem(items).map(t=>t.price).reduce((p1,p2)=>p1+p2,0) * -0.5;
        actual = rule.discountFilteredItems(items);
        console.log(expected, actual)
        expect(actual).toEqual(expected);

        //ç¬¬2ç§ï¼Œrule.discount(items)
        //è®¡ç®—çš„æ˜¯æ‰€æœ‰å•†å“åº”ç”¨æŠ˜æ‰£
        expected = items.map(t=>t.price).reduce((p1,p2)=>p1+p2,0) * -0.5;
        actual = rule.discount(items);
        console.log(expected, actual)
        expect(actual).toEqual(expected);
    }

    //ç¬¬3ç§ï¼ŒStrategy.bestMath()
    //è®¡ç®—çš„æ˜¯ç”¨æœ€ä½æˆæœ¬è¾¾æˆè§„åˆ™åŒ¹é…æ‰€éœ€è¦çš„å•†å“
    expected = (items[0].price * 2 + items[2].price *6 ) * -0.5;
    actual = Strategy.bestMatch([rule],items).totalDiscount();
    console.log(expected, actual)
    expect(actual).toEqual(expected);

    //ç¬¬4ç§ï¼ŒStrategy.bestOfOnlyOnceDiscount()
    //è®¡ç®—è¾¾æˆè§„åˆ™æ‰€éœ€çš„æœ€å°‘å¼ æ•°ï¼Œä½†æ˜¯æ˜¯æœ€é«˜ä»·æ ¼çš„å•†å“
    expected = (items[0].price * 2 + items[2].price * 6 ) * -0.5;
    const match = Strategy.bestOfOnlyOnceDiscount([rule],items)
    actual = match.totalDiscount();
    console.log(expected, actual)
    expect(actual).toEqual(expected);
    console.log(match.more);
});
```
#### ç­–ç•¥ï¼
> Strategy.bestMatch(rules,items)/Strategy.bestOfOnlyOnceDiscount(rules, items) å‡å·²åºŸå¼ƒï¼Œç»Ÿä¸€ä½¿ç”¨bestChoice(rules, items, MatchType type, MatchGroup groupSetting)ã€‚
```java
public static BestMatch bestChoice(List<Rule> rules, List<Item> items, MatchType type, MatchGroup groupSetting) {
    //... ...
}
```
```javascript
test('bestMatch',()=> {
    //#region prepare
    let r1 = Builder.rule().simplex()
        .range("[#cc01]")
        .predict(P.COUNT)
        .expected(2)
        .endRule()
        .promotion("-200")
        .build();
    let r2 = Builder.rule().simplex()
        .addRange(R.CATEGORY, "c01")
        .predict(P.COUNT)
        .expected(3)
        .endRule()
        .promotion("-300")
        .build();
    let r3 = Builder.rule().simplex()
        .addRangeAll()
        .predict(P.COUNT)
        .expected(6)
        .endRule()
        .promotion("-10%")
        .build();

    let items = _getSelectedItems();
    let rules = [r1, r2];
    //#endregion
    let bestMatch = Strategy.bestMatch(rules, items);
    expect(bestMatch.matches.length).toEqual(2);
    expect(bestMatch.matches[0].rule).toEqual(r1);
    let bestMatch1 = Strategy.bestChoice(rules,items,MatchType.OneRule);
    expect(bestMatch.matches[0].rule).toEqual(bestMatch1.matches[0].rule);
    expect(bestMatch.totalDiscount()).toEqual(bestMatch1.totalDiscount());

    let bestOfOnce = Strategy.bestOfOnlyOnceDiscount(rules, items);
    bestMatch1 = Strategy.bestChoice(rules,items,MatchType.OneTime);
    expect(bestOfOnce.matches[0].rule).toEqual(bestMatch1.matches[0].rule);
    expect(bestOfOnce.totalDiscount()).toEqual(bestMatch1.totalDiscount());

    // 5 items matched
    items.push(new Item("c01", "p02", "k03", 4000));
    let bestOfMulti = Strategy.bestChoice(rules, items, MatchType.MultiRule);
    expect(2).toEqual(bestOfMulti.matches.length);
    expect(5).toEqual(bestOfMulti.chosen().length);
    expect(-500).toEqual(bestOfMulti.totalDiscount());

    // 6 items matched
    items.push(new Item("c01", "p02", "k03", 4000));
    bestOfMulti = Strategy.bestChoice(rules,items,MatchType.MultiRule);
    expect(6).toEqual(bestOfMulti.chosen().length);
    expect(-600).toEqual(bestOfMulti.totalDiscount());

    // 7 items matched
    items.push(new Item("c01", "p02", "k03", 4000));
    bestOfMulti = Strategy.bestChoice(rules,items,MatchType.MultiRule);
    expect(3).toEqual(bestOfMulti.matches.length);
    expect(7).toEqual(bestOfMulti.chosen().length);
    expect(-700).toEqual(bestOfMulti.totalDiscount());

    // 7 items matched
    const r4 = Builder.rule().simplex().addRange(R.SPU,"p02")
        .predict(P.COUNT).expected(4).endRule()
        .promotion("-2000").build();
    rules = [r1,r2,r3,r4];
    bestOfMulti = Strategy.bestChoice(rules,items,MatchType.MultiRule);
    //expect(3).toEqual(bestOfMulti.matches.length);
    expect(14).toEqual(bestOfMulti.chosen().length);
    expect(-400-300-2000-500-600-700-800-900-200-300).toEqual(bestOfMulti.totalDiscount());

    r3.promotion = "-100";
    bestOfMulti = Strategy.bestChoice(rules,items,MatchType.MultiRule);
    expect(13).toEqual(bestOfMulti.chosen().length);
    expect(-2400).toEqual(bestOfMulti.totalDiscount());
});
```

##### å•†å“ç»„åˆ
è¥é”€æ´»åŠ¨ä¸­å­˜åœ¨è´­ä¹°ä¸€å®šæ•°é‡Aç‰©å“ï¼Œå°±è½¬æ¢æˆå¦ä¸€ä¸ªSKUï¼Œæ¯”å¦‚ä¹°12ç“¶æ°´ä¼šå˜æˆä¹°ä¸€ç®±æ°´ï¼Œæˆ–è€…ä¹°å‡ ä¸ªSKUåˆæˆå¦ä¸€ä¸ªSKUï¼Œæ¯”å¦‚ä¹°ä¸€ä»¶ä¸Šè£…åŠ ä¸€ä»¶ä¸‹è£…å˜æˆä¸€ä¸ªå¥—è£…ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœè§„åˆ™å¼•æ“èƒ½è‡ªåŠ¨å®Œæˆåˆå¹¶ï¼Œé‚£ä¹ˆåœ¨ç»„åˆè§„åˆ™æ—¶ä¼šå°‘å»åº”ç”¨å±‚å¾ˆå¤šä»£ç ï¼Œæ‰€ä»¥æä¾›äº†ä¸€ä¸ªå®ç°è¿™ä¸€åŠŸèƒ½çš„promotionè¯­æ³•ï¼š
> y:{new SKU}:{new SKU price}


ä»¥ä¸‹è§„åˆ™è¡¨ç¤ºVIP AåŒºçš„1ï¼Œ2æ’ä¸‰ä¸ªç›¸é‚»åº§å¯ä»¥åˆå¹¶æˆä¸€ä¸ªVIPå¥—ç¥¨ï¼Œå–300000
>
> [#zVIP:A:1:1-VIP:A:2:10].adjacentSeat(3)->y:VipPackage3:300000


##### è§„åˆ™åˆ†ç»„
1. è§„åˆ™å¯ä»¥åˆ†ç»„è®¡ç®—ï¼Œç»„åˆ«ä¸º1çš„è§„åˆ™å¯ä»¥å åŠ åœ¨ç»„åˆ«ä¸º0çš„è§„åˆ™åº”ç”¨çš„ç»“æœä¸Šï¼Œä¾æ­¤ç±»æ¨
2. å„ç»„è§„åˆ™å¯ä»¥æŒ‰ç»„ä¾æ¬¡è®¡ç®—ã€å åŠ ï¼Œå†å–æœ€ä¼˜ï¼Œå³MatchGroup.SequentialMath
3. å„ç»„è§„åˆ™å¯ä»¥äº¤ç»‡åœ¨ä¸€èµ·è®¡ç®—ã€å åŠ ï¼Œå–æ‰€æœ‰å¯èƒ½çš„æœ€ä¼˜ï¼Œå³MatchGroup.CrossedMatch
4. è§„åˆ™å­—ç¬¦ä¸²ååŠ @0ï¼Œè¡¨ç¤ºè§„åˆ™ä¸ºç¬¬0ç»„ï¼Œ@1è¡¨ç¤ºä¸ºç¬¬1ç»„
```javascript
//ä»¥ä¸‹ä¾‹å­åº”ç”¨äº†æ‰©å±•åœºæ™¯-å‰§é™¢åº§ä½ï¼Œå¤šäº†ä¸€ä¸ªåº§ä½çš„å±æ€§ï¼Œå¤šå¼ é‚»åº§ç¥¨å¯ä»¥ç»„åˆæˆä¸€ä¸ªè”ç¥¨ï¼Œå½¢æˆè”ç¥¨ååˆå¯ä»¥åº”ç”¨è”ç¥¨çš„ä¼˜æƒ è§„åˆ™

function getSeatedItems () {
    return [
        new Item("01", "01", "02", 10000, "äºŒæ¥¼:A:1:1"),
        new Item("01", "01", "02", 10000, "äºŒæ¥¼:A:1:3"),
        new Item("01", "01", "02", 10000, "äºŒæ¥¼:A:1:2"),
        new Item("01", "01", "02", 10000, "äºŒæ¥¼:A:1:5"),
        new Item("01", "01", "02", 10000, "äºŒæ¥¼:A:1:4"),
        new Item("02", "02", "03", 121200, "VIP:A:1:4"),
        new Item("02", "02", "03", 121200, "VIP:A:1:2"),
        new Item("02", "02", "03", 121200, "VIP:A:1:3"),
        new Item("02", "02", "03", 121200, ''),
        new Item("02", "02", "03", 121200, "")];
}

test('testPackage',()=>{
    let testItems = getSeatedItems();
    const rule1 = Interpreter.parseString("[#zVIP:A:1:1-VIP:A:2:10].adjacentSeat(3)->y:VipPackage3:300000");
    rule1.group = 0;
    const rule2 = Interpreter.parseString("[#kVipPackage3].count(1)->-10%");
    rule2.group = 1;
    const bestMatch1 = Strategy.bestChoice([rule1],testItems,MatchType.MultiRule,MatchGroup.CrossedMatch);
    expect(300000-121200*3 ).toEqual(bestMatch1.totalDiscount());
    const bestMatch2 = Strategy.bestChoice([rule1,rule2], testItems, MatchType.MultiRule, MatchGroup.CrossedMatch);
    expect((300000-121200*3) - 30000).toEqual( bestMatch2.totalDiscount());
});

test('testMatchGroup',()=>{
    let seatedItems = getSeatedItems();
    //äºŒæ¥¼:A:1:1-5
    //rule1 -2000 rule2 -1800 rule1+rule2 -3800 rule3 -4000
    const rule1 = Interpreter.parseString("[#zäºŒæ¥¼:A:1:1-äºŒæ¥¼:A:1:5].adjacentSeat(2)->y:APackage2:18000");
    rule1.group=0;
    const rule2 = Interpreter.parseString("[#kAPackage2].count(1)->-10%@1");
    const rule3 = Interpreter.parseString("[#k02].count(3)->-4000@1");
    const rules = [rule1,rule2,rule3];

    const crossedGroupMatch = Strategy.bestChoice(rules,seatedItems,
        MatchType.MultiRule,MatchGroup.CrossedMatch);
    expect(crossedGroupMatch.totalDiscount()).toEqual(-3800 -4000);

    const sequentialGroupMatch = Strategy.bestChoice(rules,seatedItems,
        MatchType.MultiRule,MatchGroup.SequentialMatch);
    expect(sequentialGroupMatch.totalDiscount()).toEqual (-3800*2);
    console.log(rule1.toString());
    console.log(rule2.toRuleString());
    console.log(rule3.toString());
});

```
å¯ä»¥çœ‹åˆ°MatchGroup.SequntialMatchæ¨¡å¼ä¸‹ï¼Œå…ˆç”¨0ç»„è§„åˆ™å°½é‡æ‰¾åˆ°äº†2ç»„å¥—ç¥¨ï¼Œç„¶ååˆ†åˆ«ä¸ºæ¯å¼ å¥—ç¥¨åº”ç”¨äº†ä¸€ä¸ª9æŠ˜çš„ç¥¨é¢ä¼˜æƒ ï¼›
åœ¨MatchGroup.CrossedMatchæ¨¡å¼ä¸‹ï¼Œé€šè¿‡è®¡ç®—ï¼Œ3å¼ ç¥¨å‡4000æ¯”ä¸¤å¼ ç¥¨ç»„æˆ1ä¸ªå¥—ç¥¨å†åº”ç”¨9æŠ˜å‡3800è¦æ›´ä¼˜æƒ ï¼Œæ‰€ä»¥æœ€ç»ˆæ˜¯3å¼ ç¥¨-4000ï¼Œå†åŠ ä¸Šä¸¤å¼ ç¥¨å½¢æˆä¸€ä¸ªå¥—ç¥¨å†9æŠ˜-3800

### åŠŸèƒ½æ‰©å±•
è§„åˆ™å¼•æ“çš„æ¨¡å—éå¸¸æ¸…æ¥šï¼Œé¢å¯¹ä¸åŒçš„ä»»åŠ¡ï¼Œå¯ä»¥åœ¨ç›¸å¯¹æ˜ç¡®çš„èŒƒå›´åšå°‘é‡è°ƒæ•´ï¼Œå¹¶å¸¦æ¥å…¨å±€çš„æ”¶ç›Šï¼š
- Rangeç›¸å…³çš„éƒ¨åˆ†æ˜¯ç”¨æ¥è¡¨è¾¾è§„åˆ™çš„åŒ¹é…èŒƒå›´ï¼Œå¦‚æœæœ‰è¿™æ–¹é¢çš„éœ€æ±‚ï¼Œåº”è¯¥åªæ”¹åŠ¨è¿™ä¸€éƒ¨åˆ†ï¼Œæ¯”å¦‚â€œIDéƒ½å¤ªé•¿äº†ï¼Œå¸Œæœ›ç›¸åŒèŒƒå›´çš„å­è§„åˆ™å¯ä»¥å¤ç”¨èŒƒå›´è®¾ç½®ï¼Œå‡å°‘è§„åˆ™å­—ç¬¦ä¸²é•¿åº¦â€ï¼Œåˆ™æˆ‘ä»¬å¢åŠ ä¸€ç§Range:SameRangeè¡¨è¾¾å³å¯ï¼›
- Predictè°“è¯æ˜¯åˆ¤æ–­åŠ¨ä½œï¼Œæ–°å¢äº†ä¸€ç§åˆ¤æ–­åŠ¨ä½œï¼Œåªéœ€è¦æ‰©å±•è¿™éƒ¨åˆ†ä»£ç å³å¯ï¼›
- Ruleã€RuleComponentæ˜¯è§„åˆ™æœ¬èº«çš„å¼ºç±»å‹è¡¨è¾¾ï¼Œé™¤äº†è§„åˆ™æ•°æ®çš„è¡¨è¾¾ï¼Œå®ƒä»¬è¿˜æ‰¿æ‹…ï¼š
    - è§„åˆ™åŒ¹é…
    - æŠ˜æ‰£è®¡ç®—
    - åŒ¹é…èŒƒå›´çš„ç¥¨çš„ç­›é€‰
- Strategyå’Œä¸€å¥—Matchç±»æ˜¯ç”¨æ¥åšå¤šä¸ªè§„åˆ™å’Œå¤šå¼ ç¥¨çš„è‡ªåŠ¨ä¼˜é€‰çš„ï¼Œä¸€èˆ¬ä¸ä¼šåŠ¨åˆ°ï¼›
- Interpreteræ˜¯å­—ç¬¦ä¸²è§£æå™¨ï¼ŒåŸºæœ¬å®ƒçš„æµç¨‹ä¸ä¼šéœ€è¦æ”¹åŠ¨ï¼Œå¯¹è§„åˆ™ç»„åˆçš„åˆ†è§£ï¼Œå¯¹å•ä¸€è§„åˆ™çš„è§£é‡Šï¼›
- Builderæ˜¯ä¸€å¥—å¼ºç±»å‹é“¾å¼åˆ›å»ºå„ç§è§„åˆ™çš„è¾…åŠ©ä½“ç³»ã€‚

#### æ‰©å±•oneSKUè°“è¯
æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•æ‰©å±•ä¸€ä¸ªoneSKUè°“è¯æ¥å®ç°è‡³å°‘æœ‰ä¸€å•ä¸ªSKUå¿…é¡»è¦è¾¾åˆ°å¤šå°‘æ•°é‡çš„åˆ¤æ–­ã€‚
##### java
- P.java
```java
//predict åˆ¤æ–­åŠ¨è¯
public enum P {
    
    //... ...

    /**
     * æŸç§SKUçš„æ•°é‡
     */
    ONE_SKU;

    @Override
    public String toString() {
        switch (this){
            //... ...
            case ONE_SKU:return "oneSKU";
        }
    }

    public static P parseString(String s){
        switch (s){
            //... ...
            case "oneSKU": return P.ONE_SKU;
        }
    }
}
```
- validator.java
```java
public class Validator {
    //@1 æœ‰æ–°çš„ç©æ³•åªéœ€åœ¨è¿™é‡ŒåŠ è°“è¯å’Œå¯¹åº”çš„å«ä¹‰
    private static HashMap<P, Function<Stream<Ticket>, Integer>> validators
            = new HashMap<P, Function<Stream<Ticket>, Integer>>(){
        {
            // ... ...
            put(P.ONE_SKU,(items) -> {
                return items.collect(
                            Collectors.groupingBy(
                                    t->t.getSKU(),
                                    Collectors.counting()))
                        .values().stream()
                        .max(Long::compare)
                        .orElse(0L).intValue();
            });
        }
    };
```
##### javascript
- enums.js
```javascript
const P = Object.freeze({
    //... ...
    ONE_SKU: {
        name: "oneSKU",
        handler: function(items){
            if(items.length < 1){
                return 0;
            }
            let map = new Map();
            for (const item of items) {
                let count = map.get(item.SKU);
                if(count){
                    map.set(item.SKU,count + 1);
                }
                else{
                    map.set(item.SKU,1);
                }
            }
            return [...map.values()].sort().reverse()[0];
        },
        toString: function (){
            return this.name;
        }
    },
    parseString: function(s){
        switch (s){
            //... ...
            case this.ONE_SKU.name:
                return this.ONE_SKU;
            //... ...
        }
    }
});
//... ...
```
ç”¨æ³•è§å•å…ƒæµ‹è¯•ä¸­çš„strategyTestä¸­çš„test_oneSKU()

### åœºæ™¯æ‰©å±•
ä¸åŒçš„åœºæ™¯ä¼šæœ‰ä¸ªæ€§åŒ–çš„éœ€æ±‚ï¼Œæºç ä¸­å·²ç»å®ç°äº†å¯¹æ¼”ç¤ºåœºæ™¯ï¼ˆç¥¨å¤šäº†åº§ä½è¿™ä¸€åŠé”®å±æ€§ï¼‰ï¼Œå¯ä»¥å‚è€ƒï¼š
1. Rangeæ”¯æŒzè¡¨ç¤ºåº§ä½
2. Predictå¢åŠ adjancetSeatåˆ¤æ–­å•†å“ç»„åˆä¸­ç¥¨æ˜¯ä¸æ˜¯è¿åº§çš„
3. ç”¨TicketSeatComparatorå°è£…æ ¹æ®åº§ä½ä¿¡æ¯åˆ¤æ–­ä¸åŒåº§ä½ä½ç½®å…³ç³»çš„é€»è¾‘

### ä»£ç ç»“æ„
ï½œ- /java -- åç«¯å®ç°ï¼Œæš‚æ—¶ä¸è€ƒè™‘ç¿»è¯‘golang/.netè¯­è¨€ç‰ˆæœ¬ï¼Œç”µå•†è¿˜æ˜¯javaå¤š  
ï½œ- /java/.../Builder.java -- è¡¨è¾¾å¼æ„é€ å™¨å…¥å£ !important  
ï½œ- /java/.../Interpreter.java -- è¡¨è¾¾å¼å­—ç¬¦ä¸²è§£æå™¨ !important  
ï½œ- /java/.../Strategy.java -- è®¡ç®—æ–¹æ³•å…¥å£ !important  
ï½œ- /java/.../model -- è§„åˆ™ç»“æ„åŒ–ç±»ä½“ç³»  
ï½œ- /java/.../model/builder -- æ„é€ å™¨çš„å¤„ç†ç±»  
ï½œ- /java/.../model/comparator -- Itemæ¯”è¾ƒé€»è¾‘  
ï½œ- /java/.../model/strategy -- è§„åˆ™è®¡ç®—é€»è¾‘ !important  
ï½œ- /java/.../model/validate -- è§„åˆ™éªŒè¯ç»“æœç±»  
ï½œ- /js -- å‰ç«¯javascriptå®ç°ï¼Œä»£ç ç»“æ„ä¸åŠŸèƒ½ä¸åç«¯å®Œå…¨ä¸€è‡´ï¼Œæš‚æ—¶ä¸è€ƒè™‘ç¿»è¯‘æˆtypescriptäº†
### License
[GPL](LICENSE.CN.txt)
